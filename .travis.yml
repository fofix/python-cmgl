language: python
python:
    - 2.7
    - 3.4
    - 3.5
    - 3.6
    - 3.7
    - 3.8

matrix:
    include:
        - os: linux

        - os: osx
          python: 2.7
          language: minimal
          env:
            - PY_VERSION=2.7-dev
        - os: osx
          python: 3.8
          language: minimal
          env:
            - PY_VERSION=3.8-dev

before_install:
    - echo $TRAVIS_OS_NAME
    - |
        if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
          sudo apt-get -qq update;
          sudo apt-get install -y \
            freeglut3-dev \
            mesa-utils;
        elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
          brew update;
          brew install \
            glew;
        fi

install:
    - |
        if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
          pip install virtualenv;
          virtualenv venv;
          source venv/bin/activate;
        elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
          brew upgrade pyenv;
          brew install pyenv-virtualenv;
          #pyenv install --list;
          pyenv install $PY_VERSION;
          #pyenv local $PY_VERSION;
          eval "$(pyenv init -)";
          eval "$(pyenv virtualenv-init -)";
          export PYENV_VERSION=$PY_VERSION;
          export PATH="/Users/travis/.pyenv/shims:${PATH}";
          pyenv virtualenv $PY_VERSION venv;
          pyenv activate venv;
        fi
    - python --version
    - pip --version
    - python -m pip install --upgrade pip wheel
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install -U py; fi  # for pytest

    - python -m pip install cython
    - python -m pip install numpy
    - python -m pip install pytest PyOpenGL

script:
    - python setup.py check
    - python setup.py build_ext --inplace --force
    #- python setup.py test
    - python -m pytest
