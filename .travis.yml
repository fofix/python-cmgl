language: python
python:
    - 2.7
    - 3.4
    - 3.5
    - 3.6
    - 3.7
    - 3.8

matrix:
    include:
        - os: linux
          python: 2.7
        - os: linux
          python: 3.4
        - os: linux
          python: 3.5
        - os: linux
          python: 3.6
        - os: linux
          python: 3.7
        - os: linux
          python: 3.8

        - os: osx
          language: minimal
          env:
            - PY_VERSION=2.7.15
        - os: osx
          language: minimal
          env:
            - PY_VERSION=2.7.15


os:
    - linux
    - osx

before_install:
    - echo $TRAVIS_OS_NAME
    - |
        if [[ "$TRAVIS_OS_NAME" == "linux" ]]; then
          sudo apt-get -qq update;
          sudo apt-get install -y \
            freeglut3-dev \
            mesa-utils;
        elif [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
          brew update;
          brew install \
            glew;
        fi

install:
    - |
        if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then
          brew upgrade pyenv;
          brew install pyenv-virtualenv;
          pyenv install --list;
          pyenv install $PY_VERSION;
          #pyenv local $PY_VERSION;
          eval "$(pyenv init -)";
          eval "$(pyenv virtualenv-init -)";
          export PYENV_VERSION=$PY_VERSION;
          export PATH="/Users/travis/.pyenv/shims:${PATH}";
          pyenv virtualenv $PY_VERSION venv;
          pyenv activate venv;
        fi
    - pip install --upgrade pip wheel
    - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then pip install -U py; fi  # for pytest

    - python -m pip install cython
    - python -m pip install numpy

script:
    - python setup.py check
    - python setup.py build_ext --inplace --force
    - python setup.py test
